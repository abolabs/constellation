version: '3.8'

services:
  maildev:
    image: djfarrelly/maildev
    ports:
      - "${SMTP}:25"
      - "${WEBUI}:80"

  mariadb:
    image: mariadb:10.5
    environment:
      MARIADB_ROOT_PASSWORD: ${MARIADB_ROOT_PASSWORD}
      MARIADB_USER: ${MARIADB_USER}
      MARIADB_PASSWORD: ${MARIADB_PASSWORD}
      MARIADB_DATABASE: ${MARIADB_DATABASE}
    ports:
      - "${MARIADB_PORT-3306}:3306"
    volumes:
      - ${DATA_VOLUME}/mariadb:/var/lib/mysql

  web-ui:
      build:
        context: .
        dockerfile: web-ui/Dockerfile
        args:
        - MYUSER=${MYUSER}
      ports:
        - "${HTTP-3000}:3000"
      volumes:
        -  ${FRONT_SOURCE_VOLUME}:/var/www
      depends_on:
        - api

  nginx:
      image: nginx:latest
      ports:
        - "${API_PORT-8080}:80"
      volumes:
        -  ${API_SOURCE_VOLUME}:/var/www
        - ${DATA_VOLUME}/nginx:/var/log/nginx
        - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
  api:
      build:
        context: .
        dockerfile: api/Dockerfile
        args:
        - MYUSER=${MYUSER}
      volumes:
        -  ${API_SOURCE_VOLUME}:/var/www
      depends_on:
        - nginx
        - redis
        - mariadb
        - meilisearch

  redis:
    image: redis
    ports:
      - "${REDIS_PORT-6379}:6379"
    volumes:
      - ${DATA_VOLUME}/redis:/data

  meilisearch:
    image: getmeili/meilisearch:v1.1
    environment:
      - MEILI_MASTER_KEY=${MEILI_MASTER_KEY}
    volumes:
      - ${DATA_VOLUME}/meili_data:/meili_data
    ports:
     - "${MEILI_MASTER_PORT-7700}:7700"
    depends_on:
      - mariadb

