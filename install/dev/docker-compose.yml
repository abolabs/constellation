version: '3.8'

services:
  maildev:
    image: djfarrelly/maildev
    ports:
      - "${SMTP}:25"
      - "${WEBUI}:80"

  mariadb:
    image: mariadb:10.5
    environment:
      MARIADB_ROOT_PASSWORD: ${MARIADB_ROOT_PASSWORD}
      MARIADB_USER: ${MARIADB_USER}
      MARIADB_PASSWORD: ${MARIADB_PASSWORD}
      MARIADB_DATABASE: ${MARIADB_DATABASE}
    ports:
      - "${MARIADB_PORT}:3306"
    volumes:
      - ${DATA_VOLUME}/mariadb:/var/lib/mysql

  front-app:
      build:
        context: .
        dockerfile: front-app/Dockerfile
        args:
        - MYUSER=${MYUSER}
      ports:
        - "${HTTP}:3000"
      volumes:
        -  ${FRONT_SOURCE_VOLUME}:/var/www

  nginx:
      image: nginx:latest
      ports:
        - "${API_PORT}:80"
      volumes:
        -  ${API_SOURCE_VOLUME}/public:/var/www/public
        - ${DATA_VOLUME}/nginx:/var/log/nginx
        - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
  api:
      build:
        context: .
        dockerfile: api/Dockerfile
        args:
        - MYUSER=${MYUSER}
      volumes:
        -  ${API_SOURCE_VOLUME}:/var/www

  redis:
    image: redis
    ports:
      - "6379:6379"
    volumes:
      - ${DATA_VOLUME}/redis:/data
